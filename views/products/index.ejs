<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-md-3">
            <!-- Categories Sidebar -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Categories</h5>
                </div>
                <div class="list-group list-group-flush">
                    <% categories.forEach(category => { %>
                        <a href="/products/category/<%= category.slug %>" 
                           class="list-group-item list-group-item-action">
                            <%= category.name %>
                        </a>
                    <% }); %>
                </div>
            </div>

            <!-- Filters -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">Filters</h5>
                </div>
                <div class="card-body">
                    <form action="/products" method="GET">
                        <div class="mb-3">
                            <label class="form-label">Price Range</label>
                            <div class="d-flex gap-2">
                                <input type="number" name="minPrice" class="form-control" placeholder="Min">
                                <input type="number" name="maxPrice" class="form-control" placeholder="Max">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Sort By</label>
                            <select name="sort" class="form-select">
                                <option value="newest">Newest</option>
                                <option value="price_asc">Price: Low to High</option>
                                <option value="price_desc">Price: High to Low</option>
                                <option value="rating">Best Rating</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Apply Filters</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-9">
            <!-- Products Grid -->
            <div class="row">
                <% products.forEach(product => { %>
                    <div class="col-md-4 mb-4">
                        <div class="card h-100">
                            <div class="position-relative">
                                <% if (product.discount > 0) { %>
                                    <div class="badge bg-danger position-absolute top-0 end-0 m-2">
                                        -<%= product.discount %>%
                                    </div>
                                <% } %>
                                <img src="<%= product.images[0] %>" 
                                     class="card-img-top" 
                                     alt="<%= product.name %>"
                                     style="height: 200px; object-fit: cover;">
                            </div>
                            <div class="card-body">
                                <h5 class="card-title text-truncate">
                                    <%= product.name %>
                                </h5>
                                <div class="mb-2">
                                    <% if (product.discount > 0) { %>
                                        <span class="text-muted text-decoration-line-through">
                                            $<%= product.originalPrice %>
                                        </span>
                                    <% } %>
                                    <span class="text-danger fw-bold ms-2">
                                        $<%= product.price %>
                                    </span>
                                </div>
                                <div class="mb-2">
                                    <% for(let i = 0; i < 5; i++) { %>
                                        <i class="bi bi-star<%= i < product.averageRating ? '-fill' : '' %> text-warning"></i>
                                    <% } %>
                                    <small class="text-muted">
                                        (<%= product.ratings.length %> reviews)
                                    </small>
                                </div>
                                <p class="card-text text-truncate">
                                    <%= product.description %>
                                </p>
                            </div>
                            <div class="card-footer bg-white border-top-0">
                                <div class="d-grid gap-2">
                                    <a href="/products/<%= product.slug %>" 
                                       class="btn btn-outline-primary">
                                        View Details
                                    </a>
                                    <% if (product.stock > 0) { %>
                                        <button class="btn btn-primary add-to-cart"
                                                data-product-id="<%= product._id %>">
                                            Add to Cart
                                        </button>
                                    <% } else { %>
                                        <button class="btn btn-secondary" disabled>
                                            Out of Stock
                                        </button>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    </div>
                <% }); %>
            </div>
        </div>
    </div>
</div> 